# DANN (Domain-Adversarial Neural Network) Training Configuration
#
# IMPORTANT: ASVspoof5 train/dev have NO codec diversity (all samples are uncoded).
# DANN is meaningless without synthetic codec augmentation to create domain labels.
# Enable augmentation below to make DANN training effective.

training:
  method: dann
  
  # Optimizer
  optimizer:
    name: adamw
    lr: 1.0e-4
    weight_decay: 0.01
    betas: [0.9, 0.999]
  
  # Scheduler
  scheduler:
    name: cosine
    warmup_steps: 500
    min_lr: 1.0e-6
  
  # Training loop
  max_epochs: 50
  patience: 10
  min_delta: 0.001            # Minimum improvement (in monitor_metric) to reset patience
  gradient_clip: 1.0
  train_loss_threshold: 0.0   # Disable train-loss early stopping for DANN
  plateau_patience: 3         # Stop if train_loss_threshold holds for N epochs
  
  # Checkpointing
  save_every_n_epochs: 5
  save_best_only: true
  monitor_metric: eer
  monitor_mode: min

# Loss
loss:
  task:
    name: cross_entropy
    weight: 1.0
    label_smoothing: 0.0
  
  # Domain adversarial losses
  domain:
    codec:
      name: cross_entropy
      weight: 1.0
    codec_q:
      name: cross_entropy
      weight: 1.0
      mask_for_none: true  # Mask CODEC_Q loss when codec is NONE

# DANN-specific settings
dann:
  lambda_: 0.1
  
  lambda_schedule:
    enabled: false
    type: linear  # linear, exponential
    start: 0.0
    end: 1.0
    warmup_epochs: 0
  
  discriminator:
    shared_dim: 256
    dropout: 0.1

# Synthetic codec augmentation (REQUIRED for meaningful DANN on ASVspoof5)
# Without augmentation, train/dev have constant domain labels (all NONE).
augmentation:
  enabled: true  # Set to true for DANN to be meaningful
  codec_prob: 0.5  # Probability of applying codec (vs keeping clean)
  codecs:
    - MP3   # Maps to C05 (mp3_wb), C07 (mp3_encodec_wb)
    - AAC   # Maps to C06 (m4a_wb)
    - OPUS  # Maps to C01 (opus_wb), C08 (opus_nb)
    # Uncomment if ffmpeg has these codecs:
    # - SPEEX  # Maps to C03, C10
    # - AMR    # Maps to C02, C09
  qualities: [1, 2, 3, 4, 5]  # Quality levels (1=lowest, 5=highest bitrate)
  cache_dir: null  # Set to path for offline caching, null for on-the-fly
  use_synthetic_labels: true  # Use augmented codec as domain label

# Logging
logging:
  log_every_n_steps: 50
  val_every_n_epochs: 1
  log_domain_accuracy: true

# Reproducibility
seed: 42
deterministic: true
